#!/usr/bin/env node

const { Command } = require('commander');
const { showBanner, showMenu } = require('../src/ui/layout');
const authCommands = require('../src/commands/auth');
const numberCommands = require('../src/commands/numbers');
const messageCommands = require('../src/commands/messages');
const billingCommands = require('../src/commands/billing');
const callCommands = require('../src/commands/calls');
const debuggerCommands = require('../src/commands/debugger');
const lookupCommands = require('../src/commands/lookup');
const simCommands = require('../src/commands/sims');
const faxCommands = require('../src/commands/fax');
const verifyCommands = require('../src/commands/verify');
const genericCommands = require('../src/commands/generic');

const program = new Command();

program
  .name('telnyx')
  .description('Command-line interface for Telnyx APIs')
  .version('1.0.0');

// Show banner and menu when no command is provided
program
  .command('start', { isDefault: true, hidden: true })
  .action(() => {
    showBanner();
    showMenu();
  });

// Auth commands
program
  .command('auth')
  .description('Authentication commands')
  .addCommand(authCommands.whoami)
  .addCommand(authCommands.login);

// Number commands
program
  .command('number')
  .description('Phone number management')
  .addCommand(numberCommands.search)
  .addCommand(numberCommands.list)
  .addCommand(numberCommands.order);

// Message commands
program
  .command('message')
  .description('Messaging commands')
  .addCommand(messageCommands.send)
  .addCommand(messageCommands.list);

// Billing commands
program
  .command('billing')
  .description('Billing and account commands')
  .addCommand(billingCommands.balance);

// Call commands (Phase 2)
program
  .command('call')
  .description('Voice call management')
  .addCommand(callCommands.dial)
  .addCommand(callCommands.hangup)
  .addCommand(callCommands.list);

// Debugger commands (Phase 2)
program
  .command('debugger')
  .description('Webhook debugging and event monitoring')
  .addCommand(debuggerCommands.list)
  .addCommand(debuggerCommands.inspect)
  .addCommand(debuggerCommands.resend);

// Lookup command (Phase 2)
program
  .command('lookup')
  .description('Phone number lookup and information')
  .addCommand(lookupCommands.lookup)
  .addCommand(lookupCommands.batch);

// SIM commands (Phase 2)
program
  .command('sim')
  .description('IoT SIM card management')
  .addCommand(simCommands.list)
  .addCommand(simCommands.show)
  .addCommand(simCommands.update);

// Fax commands (Phase 2)
program
  .command('fax')
  .description('Fax transmission management')
  .addCommand(faxCommands.send)
  .addCommand(faxCommands.list)
  .addCommand(faxCommands.status)
  .addCommand(faxCommands.cancel);

// Verify commands (Phase 2)
program
  .command('verify')
  .description('2FA and verification code management')
  .addCommand(verifyCommands.send)
  .addCommand(verifyCommands.check)
  .addCommand(verifyCommands.status)
  .addCommand(verifyCommands.list);

// Generic resource commands (Phase 3 - Long Tail)
program
  .command('resources')
  .description('List all available API resources')
  .addCommand(genericCommands.resources);

// Add all generic resource commands
Object.entries(genericCommands).forEach(([name, command]) => {
  if (name !== 'resources' && command instanceof Command) {
    program.addCommand(command);
  }
});

// Parse CLI arguments
if (process.argv.length === 2) {
  // No arguments provided - show banner and menu
  showBanner();
  showMenu();
} else {
  program.parse();
}
